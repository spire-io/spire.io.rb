<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html" title="Index">Index</a> &raquo; 
    <span class="title">File: README</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><div id='filecontents'><h1>Synopsis</h1>

<p><code>spire.io.rb</code> is a Ruby client for the <a href="http://www.spire.io/">spire.io API</a>.</p>

<h2>Basic usage</h2>

<p>The <code>Spire</code> class provides a simplified spire.io client with a high level interface.  Users of this class do not have to pay attention to details of the REST API.
Here&#39;s an example using the message service.  It assumes you have an account key, which you can get by registering at <a href="http://www.spire.io/register.html">www.spire.io</a></p>

<pre class="code ruby"><code><span class='rubyid_require identifier id'>require</span> <span class='string val'>&quot;spire_io&quot;</span>

<span class='rubyid_spire identifier id'>spire</span> <span class='assign token'>=</span> <span class='rubyid_Spire constant id'>Spire</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
<span class='rubyid_spire identifier id'>spire</span><span class='dot token'>.</span><span class='rubyid_start identifier id'>start</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span> <span class='comment val'># key is your account key</span>
<span class='rubyid_channel identifier id'>channel</span> <span class='assign token'>=</span> <span class='rubyid_spire identifier id'>spire</span><span class='dot token'>.</span><span class='rubyid_session identifier id'>session</span><span class='lbrack token'>[</span><span class='string val'>&quot;arbitrary channel name&quot;</span><span class='rbrack token'>]</span>
<span class='rubyid_channel identifier id'>channel</span><span class='dot token'>.</span><span class='rubyid_publish identifier id'>publish</span><span class='lparen token'>(</span><span class='string val'>&quot;Hello World!&quot;</span><span class='rparen token'>)</span>
</code></pre>

<p>Let&#39;s create a second session and get our messages.</p>

<pre class="code ruby"><code><span class='rubyid_spire2 identifier id'>spire2</span> <span class='assign token'>=</span> <span class='rubyid_Spire constant id'>Spire</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
<span class='rubyid_spire2 identifier id'>spire2</span><span class='dot token'>.</span><span class='rubyid_start identifier id'>start</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
<span class='rubyid_subscription identifier id'>subscription</span> <span class='assign token'>=</span> <span class='rubyid_spire2 identifier id'>spire2</span><span class='dot token'>.</span><span class='rubyid_session identifier id'>session</span><span class='dot token'>.</span><span class='rubyid_subscribe identifier id'>subscribe</span><span class='lparen token'>(</span><span class='string val'>&quot;my subscription&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;arbitrary channel name&quot;</span><span class='rparen token'>)</span>
<span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_listen identifier id'>listen</span><span class='dot token'>.</span><span class='rubyid_first identifier id'>first</span> <span class='comment val'># =&gt; &quot;Hello World!&quot;</span>
</code></pre>

<p>You can also assign listener blocks to a subscription which will be called with each message received:</p>

<pre class="code ruby"><code><span class='rubyid_spire3 identifier id'>spire3</span> <span class='assign token'>=</span> <span class='rubyid_Spire constant id'>Spire</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
<span class='rubyid_spire3 identifier id'>spire3</span><span class='dot token'>.</span><span class='rubyid_start identifier id'>start</span><span class='lparen token'>(</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span>
<span class='rubyid_subscription identifier id'>subscription</span> <span class='assign token'>=</span> <span class='rubyid_spire3 identifier id'>spire3</span><span class='dot token'>.</span><span class='rubyid_session identifier id'>session</span><span class='dot token'>.</span><span class='rubyid_subscribe identifier id'>subscribe</span><span class='lparen token'>(</span><span class='string val'>&quot;another subscription&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;arbitrary channel name&quot;</span><span class='rparen token'>)</span>
<span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_add_listener identifier id'>add_listener</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_m identifier id'>m</span><span class='bitor op'>|</span> <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Got a message: #{m}&quot;</span><span class='rbrace token'>}</span>
<span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_start_listening identifier id'>start_listening</span>
</code></pre>

<p>The subscription object will continue to monitor the channel until you call <code>#stop_listening</code> on it.</p>

<p>You can add as many listeners as you want.  They can be removed by name:</p>

<pre class="code ruby"><code><span class='rubyid_listener_name identifier id'>listener_name</span> <span class='assign token'>=</span> <span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_add_listener identifier id'>add_listener</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_m identifier id'>m</span><span class='bitor op'>|</span> <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Got a message: #{m}&quot;</span><span class='rbrace token'>}</span>
<span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_remove_listener identifier id'>remove_listener</span><span class='lparen token'>(</span><span class='rubyid_listener_name identifier id'>listener_name</span><span class='rparen token'>)</span>
</code></pre>

<p>You can also assign your own name when you add the listener as well:</p>

<pre class="code ruby"><code><span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_add_listener identifier id'>add_listener</span><span class='lparen token'>(</span><span class='string val'>&quot;Listener1&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_m identifier id'>m</span><span class='bitor op'>|</span> <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Got a message: #{m}&quot;</span><span class='rbrace token'>}</span>
<span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_remove_listener identifier id'>remove_listener</span><span class='lparen token'>(</span><span class='string val'>&quot;Listener1&quot;</span><span class='rparen token'>)</span>
</code></pre>

<p><strong>Note:</strong> Listener blocks are executed in separate threads, so please be careful when accessing shared resources.</p>

<h2>Low level interface</h2>

<p>The <code>Spire::API</code> class provides a low level spire.io client that allows you to work directly with the REST API.  The higher level <code>Spire</code> class is a wrapper around this foundation.  Where <code>Spire</code> hides the underlying HTTP traffic from the developer, sometimes making multiple requests within a single method call, <code>Spire::API</code> typically makes one request per method and expects the developer to deal with the consequences.  It also (optionally) exposes the actual HTTP requests used to interact with spire.io.</p>

<p>Usage:</p>

<pre class="code ruby"><code><span class='rubyid_require identifier id'>require</span> <span class='string val'>&quot;spire/api&quot;</span>

<span class='rubyid_api identifier id'>api</span> <span class='assign token'>=</span> <span class='rubyid_Spire constant id'>Spire</span><span class='colon2 op'>::</span><span class='rubyid_API constant id'>API</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
<span class='rubyid_api identifier id'>api</span><span class='dot token'>.</span><span class='rubyid_discover identifier id'>discover</span>
<span class='rubyid_session identifier id'>session</span> <span class='assign token'>=</span> <span class='rubyid_api identifier id'>api</span><span class='dot token'>.</span><span class='rubyid_create_session identifier id'>create_session</span><span class='lparen token'>(</span><span class='rubyid_account_key identifier id'>account_key</span><span class='rparen token'>)</span>
<span class='comment val'># session.channels is a memoizing method.</span>
<span class='comment val'># If the session has already retrieved the channels</span>
<span class='comment val'># collection, the cached version is returned.</span>
<span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_channel identifier id'>channel</span> <span class='assign token'>=</span> <span class='rubyid_session identifier id'>session</span><span class='dot token'>.</span><span class='rubyid_channels identifier id'>channels</span><span class='lbrack token'>[</span><span class='string val'>&quot;foo&quot;</span><span class='rbrack token'>]</span>
  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_channel identifier id'>channel</span> <span class='assign token'>=</span> <span class='rubyid_session identifier id'>session</span><span class='dot token'>.</span><span class='rubyid_create_channel identifier id'>create_channel</span><span class='lparen token'>(</span><span class='string val'>&quot;foo&quot;</span><span class='rparen token'>)</span>
  <span class='comment val'># if the channel named &quot;foo&quot; already exists,</span>
  <span class='comment val'># Spire::API raises an error.</span>
  <span class='rubyid_rescue rescue kw'>rescue</span>
    <span class='comment val'># session.channels! always requests the channels</span>
    <span class='comment val'># collection, ovewriting the cached version. </span>
    <span class='rubyid_channel identifier id'>channel</span> <span class='assign token'>=</span> <span class='rubyid_session identifier id'>session</span><span class='dot token'>.</span><span class='rubyid_channels! fid id'>channels!</span><span class='lbrack token'>[</span><span class='string val'>&quot;foo&quot;</span><span class='rbrack token'>]</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>

<span class='rubyid_subscription identifier id'>subscription</span> <span class='assign token'>=</span> <span class='rubyid_session identifier id'>session</span><span class='dot token'>.</span><span class='rubyid_create_subscription identifier id'>create_subscription</span><span class='lparen token'>(</span><span class='string val'>&quot;sub.name&quot;</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='string val'>&quot;foo&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='rubyid_channel identifier id'>channel</span><span class='dot token'>.</span><span class='rubyid_publish identifier id'>publish</span><span class='lparen token'>(</span><span class='string val'>&quot;message content&quot;</span><span class='rparen token'>)</span>
<span class='rubyid_events identifier id'>events</span> <span class='assign token'>=</span> <span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_retrieve_events identifier id'>retrieve_events</span>
<span class='rubyid_last_timestamp identifier id'>last_timestamp</span> <span class='assign token'>=</span> <span class='rubyid_events identifier id'>events</span><span class='lbrack token'>[</span><span class='symbol val'>:last</span><span class='rbrack token'>]</span>

<span class='rubyid_channel identifier id'>channel</span><span class='dot token'>.</span><span class='rubyid_publish identifier id'>publish</span><span class='lparen token'>(</span><span class='string val'>&quot;another message&quot;</span><span class='rparen token'>)</span>
<span class='rubyid_more_events identifier id'>more_events</span> <span class='assign token'>=</span> <span class='rubyid_subscription identifier id'>subscription</span><span class='dot token'>.</span><span class='rubyid_retrieve_events identifier id'>retrieve_events</span><span class='lparen token'>(</span><span class='symbol val'>:last</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_last_timestamp identifier id'>last_timestamp</span><span class='rparen token'>)</span>
</code></pre>

<h2>CLI usage</h2>

<p>You can also use the client from your shell</p>

<pre class="code ruby"><code><span class='comment val'># Get help and a list of all the commands supported:</span>
<span class='gt op'>&gt;</span> <span class='rubyid_spire identifier id'>spire</span> <span class='minus op'>-</span><span class='rubyid_h identifier id'>h</span>
</code></pre>

<p>i.e.
    # Open up an IRB session with an open spire session.
    &gt; spire console (-k KEY | -e EMAIL)</p>

<pre class="code ruby"><code><span class='comment val'># once in IRB you get an authenticated Spire object</span>
<span class='rshft op'>&gt;&gt;</span> <span class='rubyid_$spire gvar id'>$spire</span><span class='dot token'>.</span><span class='rubyid_api identifier id'>api</span><span class='dot token'>.</span><span class='rubyid_discover identifier id'>discover</span>      <span class='regexp val'>//</span> <span class='rubyid_get identifier id'>get</span> <span class='rubyid_the identifier id'>the</span> <span class='rubyid_API constant id'>API</span> <span class='rubyid_description identifier id'>description</span>
<span class='rshft op'>&gt;&gt;</span> <span class='rubyid_$spire gvar id'>$spire</span><span class='dot token'>.</span><span class='rubyid_session identifier id'>session</span><span class='dot token'>.</span><span class='rubyid_channels identifier id'>channels</span>      <span class='regexp val'>//</span> <span class='rubyid_get identifier id'>get</span> <span class='rubyid_a identifier id'>a</span> <span class='rubyid_list identifier id'>list</span> <span class='rubyid_of identifier id'>of</span> <span class='rubyid_Channels constant id'>Channels</span>
</code></pre>

<p>You can also add a YAML &#39;~/.spirerc&#39; file with a hash entry &#39;key&#39; containing your account key</p>

<h2>What is spire.io?</h2>

<p><a href="http://spire.io">spire.io</a> is a platform as service API.</p>

<h2>Working with this library</h2>

<ul>
<li><a href="https://github.com/spire-io/spire.io.rb">source code</a></li>
<li><a href="http://spire-io.github.com/spire.io.rb/">inline documentation</a> (via <a href="https://github.com/lsegal/yard">yardoc</a>)</li>
<li><a href="https://github.com/spire-io/spire.io.rb/issues">issues</a></li>
<li><a href="http://spire.io/contact.html">contact spire.io</a></li>
</ul>

<h1>Installation</h1>

<p>To install the latest release from rubygems.org:</p>

<pre class="code ruby"><code><span class='rubyid_gem identifier id'>gem</span> <span class='rubyid_install identifier id'>install</span> <span class='rubyid_spire_io identifier id'>spire_io</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='rubyid_pre identifier id'>pre</span>
</code></pre>

<p>If you&#39;re managing dependencies with Bundler, you can refer to this repo in your Gemfile, optionally specifying a branch or tag:</p>

<pre class="code ruby"><code><span class='rubyid_gem identifier id'>gem</span> <span class='string val'>&quot;spire_io&quot;</span><span class='comma token'>,</span>
  <span class='symbol val'>:git</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;git://github.com/spire-io/spire.io.rb.git&quot;</span><span class='comma token'>,</span>
  <span class='symbol val'>:branch</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;master&quot;</span>
</code></pre>

<p>You can also clone the repo and manage your load path in the old fashioned way. E.g.:</p>

<pre class="code ruby"><code><span class='rubyid_irb identifier id'>irb</span> <span class='minus op'>-</span><span class='rubyid_I constant id'>I</span> <span class='regexp val'>/path/</span><span class='rubyid_to identifier id'>to</span><span class='div op'>/</span><span class='rubyid_spire_io identifier id'>spire_io</span><span class='div op'>/</span><span class='rubyid_lib identifier id'>lib</span>
</code></pre>

<p>Or clone, build, and install the gem:</p>

<pre class="code ruby"><code><span class='rubyid_rake identifier id'>rake</span> <span class='rubyid_install identifier id'>install</span>
</code></pre>

<h1>Development</h1>

<h2>Tests</h2>

<p>The test suite can be run via:</p>

<pre class="code ruby"><code><span class='rubyid_rake identifier id'>rake</span> <span class='rubyid_test identifier id'>test</span>
</code></pre>

<h1>Contributing</h1>

<p>Fork and send pull requests via github, also any <a href="https://github.com/spire-io/spire.io.rb/issues">issues</a> are always welcome</p>

<h1>License</h1>

<p>Open Source Initiative OSI - The MIT License (MIT):Licensing</p>

<p>MIT LICENSE
Copyright (c) 2011 spire.io</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div></div>
    
    <div id="footer">
  Generated on Thu May 24 12:58:13 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.8.7).
</div>

  </body>
</html>